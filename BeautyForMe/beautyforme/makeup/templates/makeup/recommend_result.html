{% extends 'base.html' %}

{% load staticfiles %}

{% block extra-style %}
<style>
    * {
        margin: 0px;
        padding: 0px;
    }

    /* scroll-bar */
    .scrollbar-lady-lips::-webkit-scrollbar-track {
        -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
        background-color: #F5F5F5;
    }

    .scrollbar-lady-lips::-webkit-scrollbar {
        width: 5px;
        background-color: #F5F5F5;
    }

    .scrollbar-lady-lips::-webkit-scrollbar-thumb {
        -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
        background-image: -webkit-gradient(linear, left bottom, left top, from(#ff9a9e), color-stop(99%, #fecfef),
                to(#fecfef));
        background-image: -webkit-linear-gradient(bottom, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
        background-image: linear-gradient(to top, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
    }

    /*cosmetic part*/
    .user-cosmetic {
        width: 100%;
    }

    .gray-line {
        margin: 0px;
        padding: 0px;
        height: 1px;
        width: 100%;
        background-color: lightgray;
    }

    .black-line {
        margin: 0px;
        padding: 0px;
        height: 2px;
        width: 100%;
        background-color: lightpink;
    }

    .col-content {
        align-content: center;
    }

    .content-row {
        min-height: 50vh;
    }

    .content-brand {
        font-weight: bold;
        font-size: 14px;
        color: rgb(253, 153, 170);
    }

    .content-cosmetic {
        font-size: 14px;
    }

    .content-expiration {
        font-size: 15px;
    }

    .content-category {
        font-size: 15px;
    }

    .tag-btn {
        font-size: 11px;
        padding: 2px 6px;
        margin: 1px;
        font-weight: bold;
    }

    .cosmetic-row:hover {
        filter: grayscale(100%);
    }

    .select-row {
        opacity: 0.7;
        -webkit-box-shadow: 0 10px 10px -10px black;
        -moz-box-shadow: 0 10px 10px -10px black;
        box-shadow: 0 5px 5px -5px black;
        border-left: 1px solid gray;
    }

    .control-bar {
        background-color: white;
        top: 0px;
        z-index: 1;
    }

    .cosmetic-control-btn {
        width: 120px;
        height: 28px;
        font-size: 13px;
        padding: 3px;
    }

    .col-title {
        font-size: 13px;
        font-weight: bold;
    }

    .cosmetic-section {
        height: 75vh;
        overflow-y: scroll;
        overflow-x: hidden;
        margin-bottom: 8px;
    }

    .recommend-title {
        font-size: 18px;
    }

    .video-row {
        position: relative;
    }

    .video-row:hover {
        filter: grayscale(100%);
    }

    .video-detail-btn {
        position: absolute;
        right: 5px;
        bottom: 5px;
        width: 70px;
        height: 24px;
        font-size: 11px;
        padding: 3px;
    }

    /* transition */
    .slide-enter-active {
        -moz-transition-duration: 0.3s;
        -webkit-transition-duration: 0.3s;
        -o-transition-duration: 0.3s;
        transition-duration: 0.3s;
        -moz-transition-timing-function: ease-in;
        -webkit-transition-timing-function: ease-in;
        -o-transition-timing-function: ease-in;
        transition-timing-function: ease-in;
    }

    .slide-leave-active {
        -moz-transition-duration: 0.3s;
        -webkit-transition-duration: 0.3s;
        -o-transition-duration: 0.3s;
        transition-duration: 0.3s;
        -moz-transition-timing-function: cubic-bezier(0, 1, 0.5, 1);
        -webkit-transition-timing-function: cubic-bezier(0, 1, 0.5, 1);
        -o-transition-timing-function: cubic-bezier(0, 1, 0.5, 1);
        transition-timing-function: cubic-bezier(0, 1, 0.5, 1);
    }

    .slide-enter-to,
    .slide-leave {
        max-height: 100px;
        overflow: hidden;
    }

    .slide-enter,
    .slide-leave-to {
        overflow: hidden;
        max-height: 0;
    }

    /* thumbnail */
    .thumbnail {
        width: 100%;
    }

    .thumbnail img {
        clip-path: polygon(0 12.5%, 100% 12.5%, 100% 87.5%, 0% 87.5%);
    }
</style>
{% endblock extra-style %}

{% block navbar%}
{% include 'navbar.html' %}
{% endblock %}

{% block content %}
<div class="container-fuild" id="app" style="padding: 0 80px;">
    <div class="row d-flex align-items-center" style="height:80px;">
        <h5 class="m-0">화장품 조합 결과</h5>
    </div>
    <div class="row" style="border:1px solid rgb(82, 82, 82);"></div>
    <div class="row">
        <div class="col-4 p-0 cosmetic-section scrollbar-lady-lips thin square mt-1">
            <div class="container sticky-top row control-bar m-0 p-0">
                <div class="col-12 p-0">
                    <div class="row black-line"></div>
                    <div class="row gray-line"></div>
                    <div class="row mt-1 mb-1 pr-3 pl-3">
                        <div class="col-6 d-inline-flex">
                            <button @click="selectAll"
                                class="cosmetic-control-btn btn btn-outline-primary select-all-btn">모두
                                선택</button>
                            <button @click="addInterested" class="ml-1 cosmetic-control-btn btn btn-outline-primary">관심
                                등록</button>
                        </div>
                    </div>
                    <div class="row gray-line"></div>
                    <div class="row ml-0 mr-0 mt-1 mb-1">
                        <div class="col-12 col-title  text-center">제품</div>
                    </div>
                    <div class="row black-line"></div>
                </div>
            </div>
            <div v-for="(cosmetic, index) in cosmetics" :key="cosmetic.id"
                class="container p-0 mt-1 mb-1 cosmetic-container cosmetic-row">
                <div class="row m-0" @click="selectCosmetic($event, index, cosmetic.id)">
                    <div class="col-3 col-content d-flex justify-content-center align-items-center">
                        <img :src="[[cosmetic.imageLink]]" alt="" class="user-cosmetic justify-content-center">
                    </div>
                    <div class="col-9 col-content d-flex flex-column justify-content-center">
                        <div class="row content-brand">[[cosmetic.brandName]]</div>
                        <div class="row content-cosmetic">[[cosmetic.productName]] [[cosmetic.typeName]]
                        </div>
                    </div>
                </div>
                <div class="gray-line"></div>
            </div>
        </div>
        <div class="col-8 p-0 pl-3 cosmetic-section scrollbar-lady-lips thin square mt-1">
            <div class="container sticky-top row control-bar m-0 p-0">
                <div class="col-12 p-0">
                    <div class="row black-line"></div>
                    <div class="row gray-line"></div>
                    <div class="row mt-1 mb-1 pr-3 pl-3">
                        <div class="col-6 d-inline-flex">
                            <button @click="selectVideoAll"
                                class="cosmetic-control-btn btn btn-outline-primary select-video-all-btn">모두
                                선택</button>
                            <button @click="" class=" ml-1 cosmetic-control-btn btn btn-outline-primary">스크랩하기</button>
                        </div>
                        <div class="col-6 d-inline-flex justify-content-end">
                        </div>
                    </div>
                    <div class="row gray-line"></div>
                    <div class="row ml-0 mr-0 mt-1 mb-1">
                        <div class="col-7 col-title pl-3">추천 영상</div>
                        <div class="col-5 col-title pl-3">포함 제품</div>
                    </div>
                    <div class="row black-line"></div>
                </div>
            </div>
            <div v-for="(video, index) in videos" :key="video.id"
                class="container p-0 mt-1 mb-1 cosmetic-container video-row">
                <div class="row m-0" @click="selectVideo($event, index, video.id)">
                    <div class="thumbnail col-3 col-content d-flex justify-content-center align-items-center">
                        <img :src="[[video.thumbnail]]" alt="" class="user-cosmetic justify-content-center">
                    </div>
                    <div class="col-4 col-content d-flex flex-column justify-content-center">
                        <div class="row content-brand">[[video.youtuber]]</div>
                        <div class="row content-cosmetic">[[video.title]]</div>
                        <div class="row content-cosmetic">[[video.upload_date]] / Views. [[video.hits]]
                        </div>
                        <div class="ml-3 btn btn-outline-primary cosmetic-control-btn video-detail-btn">
                            자세히
                        </div>
                    </div>
                    <div class="col-5 col-content d-flex flex-column justify-content-center pl-4">
                        <div v-for="cosmetic in video.cosmetics" class="row content-cosmetic">
                            <span class="content-brand mr-1">[[ cosmetic.brandName ]]</span> [[ cosmetic.productName ]]
                            [[ cosmetic.typeName ]]
                        </div>
                    </div>
                </div>

                <div class="gray-line"></div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block footer %}
{% include 'footer.html' %}
{% endblock footer %}

{% block extra-script %}
<script src="https://unpkg.com/vue/dist/vue.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    axios.defaults.xsrfCookieName = 'csrftoken';
    axios.defaults.xsrfHeaderName = 'X-CSRFToken';

    function cosmeticInsert(data) {
        var imageLink;

        if (data.cosmetic.product.image_link)
            imageLink = data.cosmetic.product.image_link;
        else
            imageLink = data.cosmetic.image_link;

        var tagNames = [];
        for (var tag_index in data.cosmetic.product.tag_names)
            tagNames.push(data.cosmetic.product.tag_names[tag_index].tag_name);
        const smallCategory = data.cosmetic.product.category.small_category.replace("-", "<br/>");

        var cosmetic = {
            id: data.cosmetic.id,
            brandName: data.cosmetic.product.brand.brand_name,
            productName: data.cosmetic.product.product_name,
            typeName: data.cosmetic.type_name,
            imageLink: imageLink,
            tagNames: tagNames,
            smallCategory: smallCategory,
            smallCategoryId: data.cosmetic.product.category.id,
            rgbValue: data.cosmetic.rgb_value,
            similarCosmetics: data.cosmetic.similar_cosmetics,
            selectedCosmetics: [],
            showSimilar: false,
            similarCosmetics: [],
        };
        return cosmetic;
    }

    var vm = new Vue({
        delimiters: ['[[', ']]'],
        el: '#app',
        data: {
            cosmetics: [],
            videos: [],
            selectedCosmetics: [],
            selectedVideos: [],
            isSelectAll: false,
            isSelectVideosAll: false,
        },
        methods: {
            btnOn(btnElement) {
                btnElement.classList.remove("btn-outline-primary");
                btnElement.classList.add("btn-primary");
            },
            btnOff(btnElement) {
                btnElement.classList.remove("btn-primary");
                btnElement.classList.add("btn-outline-primary");
            },
            selectCosmetic(event, arrayIndex, cosmeticId) {
                console.log(cosmeticId);

                var cosmeticRow = document.querySelectorAll(".cosmetic-row")[arrayIndex];

                for (var index in this.selectedCosmetics) {
                    if (this.selectedCosmetics[index].arrayIndex == arrayIndex) {
                        cosmeticRow.classList.remove("select-row");
                        this.selectedCosmetics.splice(index, 1);
                        this.isSelectAll = false;
                        this.btnOff(document.querySelector(".select-all-btn"));
                        return;
                    }
                }
                this.selectedCosmetics.push({
                    arrayIndex: arrayIndex,
                    cosmeticId: cosmeticId
                })
                cosmeticRow.classList.add("select-row");

                if (this.selectedCosmetics.length == this.cosmetics.length) {
                    this.isSelectAll = true;
                    this.btnOn(document.querySelector(".select-all-btn"));
                }
            },
            selectAll() {
                var cosmeticRows = document.querySelectorAll(".cosmetic-row");

                if (this.isSelectAll) {
                    this.selectedCosmetics = [];
                    for (var index = 0; index < cosmeticRows.length; index++) {
                        cosmeticRows[index].classList.remove("select-row");
                    }
                    this.btnOff(document.querySelector(".select-all-btn"));
                    this.isSelectAll = false;
                }
                else {
                    this.selectedCosmetics = [];
                    for (var index = 0; index < cosmeticRows.length; index++) {
                        cosmeticRows[index].classList.add("select-row");
                        this.selectedCosmetics.push({
                            arrayIndex: index,
                            cosmeticId: this.cosmetics[index].id
                        })
                    }
                    this.btnOn(document.querySelector(".select-all-btn"));
                    this.isSelectAll = true;
                }
            },
            addInterested() {
                console.log(this.selectedCosmetics);
                for (var i in this.selectedCosmetics) {
                    var postData = {
                        cosmetic_id: this.selectedCosmetics[i].cosmeticId,
                    };

                    console.log(postData);

                    axios.post('/api/user/cosmetic/interested/', postData)
                        .then((res) => {
                            console.log("GET SUCCESS", res);
                        })
                        .catch(function (err) {
                            console.log("GET FAIL", err);
                        });
                }
            },
            selectVideo(event, arrayIndex, videoId) {
                console.log(videoId);

                var videoRow = document.querySelectorAll(".video-row")[arrayIndex];

                for (var index in this.selectedVideos) {
                    if (this.selectedVideos[index].arrayIndex == arrayIndex) {
                        videoRow.classList.remove("select-row");
                        this.selectedVideos.splice(index, 1);
                        this.isSelectVideoAll = false;
                        this.btnOff(document.querySelector(".select-video-all-btn"));
                        return;
                    }
                }
                this.selectedVideos.push({
                    arrayIndex: arrayIndex,
                    videoId: videoId
                })
                videoRow.classList.add("select-row");

                if (this.selectedVideos.length == this.videos.length) {
                    this.isSelectVideoAll = true;
                    this.btnOn(document.querySelector(".select-video-all-btn"));
                }
            },
            selectVideoAll() {
                var videoRows = document.querySelectorAll(".video-row");

                if (this.isSelectVideoAll) {
                    this.selectedVideos = [];
                    for (var index = 0; index < videoRows.length; index++) {
                        videoRows[index].classList.remove("select-row");
                    }
                    this.btnOff(document.querySelector(".select-video-all-btn"));
                    this.isSelectVideoAll = false;
                }
                else {
                    this.selectedVideos = [];
                    for (var index = 0; index < videoRows.length; index++) {
                        videoRows[index].classList.add("select-row");
                        this.selectedVideos.push({
                            arrayIndex: index,
                            videoId: this.videos[index].id
                        })
                    }
                    this.btnOn(document.querySelector(".select-video-all-btn"));
                    this.isSelectVideoAll = true;
                }
            },
        },
        created() {
            axios.get('/api/user/cosmetic/')
                .then((res) => {
                    console.log("GET SUCCESS", res);
                    const data = res.data;

                    for (var i in data)
                        this.cosmetics.push(cosmeticInsert(data[i]));

                    this.videos = [
                        {
                            id: 1,
                            title: "K-pop idol Suzy makeup 수지 화보 메이크업 싱크로율은? l 이사배(Risabae Makeup)",
                            thumbnail: "https://img.youtube.com/vi/4RnJVdE6Wxg/0.jpg",
                            link: "https://youtu.be/4RnJVdE6Wxg",
                            upload_date: "2016. 8. 23.",
                            hits: "1137834",
                            youtuber: "Risabae",
                            cosmetics: [
                                {
                                    id: 1,
                                    brandName: "조르지오아르마니",
                                    productName: "디자이너 리프트 파운데이션 [SPF20/PA+++]",
                                    typeName: "#2 핑크 베이스",
                                },
                                {
                                    id: 2,
                                    brandName: "로라메르시에",
                                    productName: "시크릿 카뮤플라지",
                                    typeName: "SC3(노랗거나 핑크 톤의 보통 피부톤)",
                                },
                                {
                                    id: 3,
                                    brandName: "슈에무라",
                                    productName: "하드포뮬라",
                                    typeName: "씰브라운",
                                },
                                {
                                    id: 4,
                                    brandName: "바닐라코",
                                    productName: "프라임 프라이머 피니쉬 블러 팩트",
                                    typeName: "BLENDING",
                                },
                            ]
                        },
                        {
                            id: 2,
                            title: "원더걸스 선미 메이크업 WonderGirls Sunmi Why so lonely makeup l 이사배(Risabae Makeup)",
                            thumbnail: "https://img.youtube.com/vi/WYNt6Ybpa8s/0.jpg",
                            link: "https://youtu.be/WYNt6Ybpa8s",
                            upload_date: "2016. 8. 1.",
                            hits: "1245284",
                            youtuber: "Risabae",
                            cosmetics: [
                                {
                                    id: 1,
                                    brandName: "조르지오아르마니",
                                    productName: "디자이너 리프트 파운데이션 [SPF20/PA+++]",
                                    typeName: "#2 핑크 베이스",
                                },
                                {
                                    id: 2,
                                    brandName: "로라메르시에",
                                    productName: "시크릿 카뮤플라지",
                                    typeName: "SC3(노랗거나 핑크 톤의 보통 피부톤)",
                                },
                                {
                                    id: 3,
                                    brandName: "슈에무라",
                                    productName: "하드포뮬라",
                                    typeName: "씰브라운",
                                },
                            ]
                        },
                        {
                            id: 3,
                            title: "영화 '아가씨' 김민희 메이크업! l 이사배(Risabae Makeup)",
                            thumbnail: "https://img.youtube.com/vi/CZ9qlm2Jr2Q/0.jpg",
                            link: "https://youtu.be/CZ9qlm2Jr2Q",
                            upload_date: "2016. 6. 20.",
                            hits: "855987",
                            youtuber: "Risabae",
                            cosmetics: [
                                {
                                    id: 3,
                                    brandName: "슈에무라",
                                    productName: "하드포뮬라",
                                    typeName: "씰브라운",
                                },
                                {
                                    id: 3,
                                    brandName: "베네피트 (benefit)",
                                    productName: "헬로 플로리스 [SPF15]",
                                    typeName: "아이보리",
                                },
                            ]
                        },
                        {
                            id: 4,
                            title: "I.O.I 정채연 메이크업 Jeong Chaeyeon make up! l 이사배(Risabae Makeup)",
                            thumbnail: "https://img.youtube.com/vi/ON2RIwPiGDo/0.jpg",
                            link: "https://youtu.be/ON2RIwPiGDo",
                            upload_date: "2016. 5. 16.",
                            hits: "429295",
                            youtuber: "Risabae",
                            cosmetics: [
                                {
                                    id: 3,
                                    brandName: "슈에무라",
                                    productName: "하드포뮬라",
                                    typeName: "아콘",
                                },
                                {
                                    id: 3,
                                    brandName: "베네피트 (benefit)",
                                    productName: "헬로 플로리스 [SPF15]",
                                    typeName: "아이보리",
                                },
                            ]
                        },
                        {
                            id: 5,
                            title: "TWICE Cheer Up 사나 메이크업 샤샤샤~ l 이사배(Risabae Makeup)",
                            thumbnail: "https://img.youtube.com/vi/QNxMmcpc3iY/0.jpg",
                            link: "https://youtu.be/QNxMmcpc3iY",
                            upload_date: "2016. 5. 12.",
                            hits: "312392",
                            youtuber: "Risabae",
                            cosmetics: [
                                {
                                    id: 2,
                                    brandName: "로라메르시에",
                                    productName: "시크릿 카뮤플라지",
                                    typeName: "SC3(노랗거나 핑크 톤의 보통 피부톤)",
                                },
                                {
                                    id: 3,
                                    brandName: "슈에무라",
                                    productName: "하드포뮬라",
                                    typeName: "아콘",
                                },
                            ]
                        },
                        {
                            id: 6,
                            title: "장나라 메이크업 한번더 헤퓌엔딩 l 이사배(Risabae Makeup)",
                            thumbnail: "https://img.youtube.com/vi/fCJQp9Av8P0/0.jpg",
                            link: "https://youtu.be/fCJQp9Av8P0",
                            upload_date: "2016. 5. 5.",
                            hits: "324071",
                            youtuber: "Risabae",
                            cosmetics: [
                                {
                                    id: 3,
                                    brandName: "베네피트 (benefit)",
                                    productName: "헬로 플로리스 [SPF15]",
                                    typeName: "아이보리",
                                },
                                {
                                    id: 3,
                                    brandName: "슈에무라",
                                    productName: "하드포뮬라",
                                    typeName: "아콘",
                                },
                            ]
                        },
                    ];
                })
                .catch(function (err) {
                    console.log("GET FAIL", err);
                });
        },
    })
</script>
{% endblock extra-script %}