{% extends 'base.html' %}
{% block title %}
{% endblock %}

{% block extra-style%}
<style>
  .big-category-title {
    font-size: 24px;
    height: 80px;
  }

  .category-section {
    padding-bottom: 20px;
    border-top: 1px solid black;
    border-bottom: 1px solid black;
  }

  .category-wrapper {
    height: 90px;
  }

  .save-btn {
    font-size: 15px;
    padding: 5px 15px;
  }

  .category-title {
    font-size: 13px;
    font-weight: bold;
    color: gray;
    height: 40px;
    align-items: center;
    justify-content: center;
  }

  .importance-input {
    text-align: center;
    font-size: 14px;
    padding: 5px;
    border: 0px;
    border: 1px solid pink;
    border-radius: 5px;
  }

  input::-webkit-outer-spin-button,
  input::-webkit-inner-spin-button {
    /* display: none; <- Crashes Chrome on hover */
    -webkit-appearance: none;
    margin: 0;
    /* <-- Apparently some margin are still there even though it's hidden */
  }

  input[type=number] {
    -moz-appearance: textfield;
    /* Firefox */
  }
</style>
{% endblock %}


{% block navbar%}
{% include 'navbar.html' %}
{% endblock %}

{% block content %}
<div id="app">
  <div class="container">
    <div v-for="category in categories">
      <div class="row ">
        <div v-html="category.bigCategory"
          class="col-12 big-category-title d-flex justify-content-center align-items-center"></div>
      </div>
      <div class="row category-section">
        <div v-for="smallCategory in category.smallCategories"
          class="col-2 category-wrapper d-felx justify-content-center mt-1">
          <div v-html="smallCategory.name" class="category-title row text-center"></div>
          <div class="d-flex justify-content-center">
            <input type="number" min=0 max=10 class="importance-input" :value="smallCategory.value">
            [[smallCategory.value]]
          </div>
        </div>
      </div>
    </div>
    <div class="row d-flex justify-content-end mr-2 mt-3 mb-3">
      <button class="btn btn-primary save-btn">저장하기</button>
    </div>
  </div>
</div>
{% endblock %}

{% block extra-script %}
<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
  axios.defaults.xsrfCookieName = "csrftoken";
  axios.defaults.xsrfHeaderName = "X-CSRFToken";

  var user = new Vue({
    delimiters: ["[[", "]]"],
    el: "#app",
    data: {
      categories: [],
      loadUserOnce: true,
    },
    created() {
      axios.get('/api/cosmetic/bigcategory/')
        .then((res) => {
          const data = res.data;
          this.categories = [];

          for (var i = 0; i < data.length; i++) {
            this.categories.push({
              bigCategory: "",
              smallCategories: {},
            });
          }
          for (var i in data) {
            this.categories[i].bigCategory = data[i].big_category;

            var postData = {
              params: {
                big_category_id: data[i].id,
                big_category_index: i
              }
            };
            axios.get('/api/cosmetic/smallcategory/', postData)
              .then((response) => {
                const smallData = response.data;
                const bigCategoryIndex = response.config.params.big_category_index;

                this.categories[bigCategoryIndex].smallCategories = [];
                for (var index in smallData) {
                  const name = smallData[index].small_category.replace("-", "<br/>");
                  this.categories[bigCategoryIndex].smallCategories.push({
                    name: name
                  });
                }
                if (this.loadUserOnce)
                  this.loadUserOnce = false;
              })
              .catch(function (err) {
                console.log("GET FAIL", err);
              });
          }
        })
        .catch(function (err) {
          console.log("GET FAIL", err);
        });
    },
    updated() {
      if (this.loadUserOnce == false) {
        axios.get('/api/user/cosmetic/importance/')
          .then((response) => {
<<<<<<< HEAD
            console.log(response)
            console.log(response.data);
=======
            var inputStream = "";
            for (var i in response.data.importance) {
              if (response.data.importance[i] != '"') {
                inputStream = inputStream.concat('', response.data.importance[i]);
              }
            }
            inputStream = inputStream.replace("{", "").replace("}", "");

            var splitedInputStream = inputStream.split(", ");
            for (var i in splitedInputStream) {
              var name = splitedInputStream[i].split(": ")[0].replace("-", "<br/>");
              var value = splitedInputStream[i].split(": ")[1];
              for (var i in this.categories) {
                for (var j in this.categories[i].smallCategories) {
                  if (this.categories[i].smallCategories[j].name == name) {
                    this.categories[i].smallCategories[j]["value"] = value;
                  }
                }
              }
            }
            console.log(this.categories);
<<<<<<< HEAD

>>>>>>> 화장품 중요도 받아오기
=======
>>>>>>> 카테고리 수신 수정
          })
          .catch(function (err) {
            console.log("GET FAIL", err);
          });

        this.loadUserOnce = true;
      }
    },
    methods: {
    }
  });
</script>
{% endblock %}